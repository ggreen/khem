<!DOCTYPE html>
<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" >
<head>
  <title>KHEM</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.11.2/dojo/dojo.js"></script>

    <script type="text/javascript" src='Scilligence.JSDraw2.Pro.js'></script>
    <script type="text/javascript" src='Scilligence.JSDraw2.Resources.js'></script>

  </head>

<body>

<div>
  <button onclick="findMolecules()">find molecules</button>

	<div id="editor">
			<div class='JSDraw' id="editorJSDraw" skin="w8" style="width: 660px; height: 300px;border:1px solid gray" ondatachange='molchange'
    dataformat='molfile' data='
ChemJSDraw11140919362D

  6  6  0  0  0  0  0  0  0  0  1 V2000
    3.5115   -9.3600    0.0000 C   0  0
    2.1605   -8.5800    0.0000 C   0  0
    2.1605   -7.0200    0.0000 C   0  0
    3.5115   -6.2400    0.0000 N   0  0
    4.8625   -7.0200    0.0000 C   0  0
    4.8625   -8.5800    0.0000 C   0  0
  1  2  1  0
  2  3  2  0
  3  4  1  0
  4  5  2  0
  5  6  1  0
  6  1  2  0
M  END'></div>
	</div>

</div>

<div id="moleculesPanel">

</div>

<script type="text/javascript">
    JSDraw.init();
    
    function molchange(jsdraw) {
        document.getElementById('formula').innerHTML = jsdraw.getFormula(true);
        document.getElementById('mw').innerHTML = jsdraw.getMolWeight();
    }
</script>

	<script  type="text/javascript">
		function findMolecules()
		{
			//var editorDiv = document.getElementById("editor");
			//editorDiv.style = 'display: none';
			
			
			var xhttp = new XMLHttpRequest();
			  xhttp.onreadystatechange = function() {
			    if (this.readyState == 4 && this.status == 200) {
			     document.getElementById("moleculesPanel").innerHTML = this.responseText;
			    }
			  };
			  
			  
			  xhttp.open("POST", "findMolecules",  true);
			  xhttp.onreadystatechange = function() {
			        if (this.readyState == 4 && this.status == 200) {
			        	
			        	
			        	var moleculeArray =  JSON.parse(this.responseText);
			        	var tableHtml = "";
			        	
			        	//loop thru molecules
			        	for (i = 0; i < moleculeArray.length; i++) {
			        		tableHtml += "<tr><td>"+moleculeArray[0].name+"</td>";
			        		
			        		//add mol file
			        		tableHtml += "<td><div class='JSDraw' id='div1' style='width: 330px; height: 330px;border:1px solid gray' viewonly popup dataformat='molfile' data='"+moleculeArray[0].molString+"'></div></td>";
			        		
			        		tableHtml += "</tr>";
			        	}
			        	 
			        	tableHtml = "<table class=\"selectResults\">"+tableHtml+"</table>";
			        	
			         document.getElementById("moleculesPanel").innerHTML =tableHtml;

			       }
			  };
			        
			  xhttp.setRequestHeader("Content-Type", "application/json");
			  
			  var molStringFile = JSDraw.get("editorJSDraw").getMolfile();
			  
			  //alert('molfile:'+molStringFile);
			  
			  var khemCriteria = {
					  structureCriteria:
						  {
						  molString : molStringFile,
			  
			  				pageCriteria : {
			  					size: 100
			  				},
			  				
			  				sources : ["eMolecules"]
						  }
			  };
			  //var mater
			  var json = JSON.stringify(khemCriteria);
			  //alert("json:"+json);
			  
			  xhttp.send(json);
			
			
			return 0;
		
		}
	</script>
</body>
</html>